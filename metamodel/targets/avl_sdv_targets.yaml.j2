# Copyright (C) Microsoft Corporation.

azure_login:
  description: Login to Azure using a VM's system-assigned managed identity
  type: azure login

execute_avl_devops_artifact_collection:
  description: Executes the AVL DevOps artifact collection
  type: avl devops custom extension run script with parameters
  depends_on:
    - azure_login
  parameters:
    input_parameter: {{ config }}

deploy_avl_symphony_campaign:
  description: The Symphony campaign to deploy and setup the AVL DevOps environment
  type: symphony campaign
  depends_on:
    - azure_login
    - execute_avl_devops_artifact_collection
  parameters:
    campaign_name: deploy_avl_devops_symphony_campaign
    campaign_activation_name: deploy_avl_devops_symphony_campaign_activation

# Empty stage will use the default stage as defined in symphony-campaign.json
    campaign_start_stage:
    campaign_start_stage_inputs:

    symphony_campaign_parameters_file: ./targets/deploy_avl_devops_symphony_campaign.json.j2
    symphony_campaign_parameters_file_input:
      toolchain_output_path: {{ config.symphony.toolchain_output_path }}
    symphony_authority: {{ config.symphony.symphony_authority }}
